(e=>{function t(t,n=e){return n?.querySelector(t)}function n(t,n=e){return n?n.querySelectorAll(t):[]}function s(e){return e.childElementCount}const a=e.createElement("div"),r=n("h1").length>1,i=[],o=String.fromCharCode(...Array(10).fill(0).map((e=>97+26*Math.random()))),c="pagesjs-fragmented",l=["top","bottom"].map((t=>+getComputedStyle(e.documentElement).getPropertyValue(`--paper-margin-${t}`).replace("px","")||0));a.className="pagesjs-page",a.innerHTML='<div class="pagesjs-header"></div>\n<div class="pagesjs-body"></div>\n<div class="pagesjs-footer"></div>';let f,d,p,g=[];function h(e){return e&&!t(".pagesjs-body",e)&&e.insertAdjacentHTML("afterbegin",a.innerHTML),f=e||a.cloneNode(!0),d=f.children[1],g.length&&f.classList.add(...g),i.push(f),f}function m(e){const t=e.scrollHeight;if(t>p&&!e.dataset.pagesOffset){const s=function(e,t){let s=+e.dataset.pagesOffset;if(s)return s;if(s=Math.ceil(t/p),s<=1)return s;const a=l.concat([...n("thead",e)].map((e=>+e.offsetHeight))).reduce(((e,t)=>e+t));if(!a)return s;function r(){return Math.ceil((t+(s-1)*a)/p)}let i=r();for(;i>s;)s=i,i=r();return s}(e,t);s>1&&(e.dataset.pagesOffset=s)}e.classList.add("pagesjs-done")}function u(e){if(!e)return!1;const t=""===e.innerText.trim();return t&&e.remove(),t}function E(e){const t=i.length;if(e.classList.contains("pagesjs-page"))f.after(h(e)),s(e)>3&&(d.append(...[...e.children].slice(3)),f.after(h()));else{if(f.scrollHeight>p){const[e,t]=[f,d];e.after(h()),s(t)>1&&d.append(t.lastChild)}d.append(e),L(e)}const n=i.length;n>t&&n>1&&i.splice(0,n-1).forEach(m)}function L(e,t,a,r){const i=e.tagName,l="CODE"===i;if((!l||!t)&&f.scrollHeight<=p)return;e.classList.add(c);const g=r||f,m=e.cloneNode();if(t?t.append(m):(d.append(m),g.after(h()),d.append(e)),"PRE"===i){const T=e.firstElementChild;if("CODE"===T?.tagName){const H=T.innerHTML.replace(/\n$/,"").split("\n");H.length>1&&(T.innerHTML=H.concat("").map((e=>`<i class="${o}"></i>${e}`)).join("\n"),n(`i.${o}`,T).forEach((e=>e.dataset.top=e.offsetTop)),L(T,m,e,g))}}else"DIV"===i&&1===s(e)&&L(e.firstElementChild,m,e,g);const E=m.previousElementSibling;if(["UL","OL","BLOCKQUOTE"].includes(i)&&s(e)>1)for(;;){const v=e.firstChild;if(!v)break;if(m.append(v),!v.nodeName.startsWith("#")&&g.scrollHeight>p){(E||s(m)>1)&&e.insertBefore(v,e.firstChild),"OL"===i&&(e.start+=s(m));break}}if(l){const C=e.innerHTML.split("\n"),O=p-g.scrollHeight,y=[...n(`i.${o}`,e)].map((e=>e.dataset.top));let M=0;function j(){m.innerHTML=C.slice(0,M).join("\n")}if(O>0){for(M=0;M<y.length&&!(y[M+1]-y[0]>O);M++);M>0&&j()}const S=g.scrollHeight>p?-1:1;for(;M>0&&M<=C.length;)if(M+=S,j(),g.scrollHeight>p){M+=-1,j();break}if(M>0&&(e.innerHTML=C.slice(M).join("\n"),u(a)))return}const b=u(m);b&&e.classList.remove(c),(!b||l||E)&&L(t?a:e)}function j(e){return e&&(e.dataset.shortTitle||e.innerText)}const b=j(t("h1.title, .frontmatter h1, .title, h1")),T=(r?"h1":"h2")+":not(.frontmatter *)";function H(){if("complete"!==e.readyState)return setTimeout(H,10);const s=e.body.classList;if(s.contains("pagesjs"))return;s.add("pagesjs"),e.body.insertAdjacentElement("afterbegin",h()),p=f.clientHeight||window.innerHeight,n(":is(#TOC, .footnotes, .chapter-before, .chapter-after):is(.side-left, .side-right).side").forEach((e=>{e.classList.remove("side","side-left","side-right")})),s.add("pagesjs-filling"),n('#TOC a[href^="#"]').forEach((t=>{const n=e.createElement("span"),s=t.firstElementChild;for(s?.classList.contains("section-number")?s.after(n):t.insertAdjacentElement("afterbegin",n);n.nextSibling;)n.append(n.nextSibling);t.insertAdjacentHTML("beforeend",'<span class="dot-leader"></span>'),t.dataset.pageNumber="000"})),[t(".frontmatter"),t("#TOC"),t(".abstract")].forEach((e=>{e&&(E(e),r&&f.after(h()))})),n(".body").forEach((e=>{g=["chapter","appendix"].filter((t=>e.classList.contains(t))),r&&(""===f.innerText?h(f):f.after(h())),[...e.children].map(E),u(e.parentNode),u(e)})),i.forEach(m),n(`pre > code i.${o}`).forEach((e=>e.remove())),s.remove("pagesjs-filling");let a,c=0;n(".pagesjs-page").forEach((e=>{if(u(e))return;if(r){if(t(".frontmatter",e))return;t(T,e)&&(a="")}const s=+e.dataset.pagesOffset||1;s>1&&e.classList.add("page-multiple"),c+=s,e.classList.add("page-"+(c%2==0?"even":"odd"));const i={pageNumber:c,mainTitle:b,pageTitle:a};let o;[e.children[0],e.children[2]].forEach((e=>{for(const t in i)i[t]&&(e.dataset[t]=i[t])})),a=j([...n(T,e)].pop())||a,n(".footnotes",e).forEach(((t,n)=>{0===n?(o=t,e.children[1].after(t)):(o.append(...t.children),t.remove())}))})),n('#TOC a[href^="#"]').forEach((e=>{const n=t(`.pagesjs-page:has(#${CSS.escape(e.getAttribute("href").replace(/^#/,""))}) .pagesjs-header`);e.dataset.pageNumber=n?n.dataset.pageNumber:""})),n(".pagesjs-done").forEach((e=>e.classList.remove("pagesjs-done")))}addEventListener("beforeprint",H);let v=sessionStorage.getItem("pagesjs");v&&H(),addEventListener("keypress",(e=>"p"===e.key&&(H(),v=v?"":"1",sessionStorage.setItem("pagesjs",v),v||location.reload())))})(document);
//# sourceMappingURL=pages.min.js.map